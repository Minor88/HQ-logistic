# Детальный план разработки фронтенда HQ-logistic

## 1. Базовая структура и настройка проекта 

### 1.1 Настройка проекта
- [✅] Инициализация Next.js проекта с TypeScript
- [✅] Настройка ESLint и Prettier
- [✅] Настройка Tailwind CSS
- [✅] Настройка PostCSS и Autoprefixer
- [✅] Создание структуры директорий
- [✅] Настройка алиасов для импорта
- [✅] Настройка переменных окружения (.env)

### 1.2 Базовые компоненты UI
- [✅] Создание настраиваемых компонентов кнопок (Button, IconButton)
- [✅] Создание компонентов форм (Input, Select, Checkbox, RadioButton)
- [✅] Создание компонентов модальных окон (Modal, Dialog, Drawer)
- [✅] Создание компонентов уведомлений (Toast, Alert)
- [✅] Создание компонентов навигации (Navbar, Sidebar, Breadcrumbs)
- [✅] Создание компонентов таблиц (Table, TableRow, TableCell, Pagination)
- [✅] Создание компонентов загрузки (Spinner, Skeleton)

### 1.3 Интеграция библиотек
- [✅] Настройка React Query для работы с API
- [ ] Настройка Zustand для глобального состояния
- [✅] Настройка React Hook Form и Zod для валидации форм
- [✅] Настройка Axios для HTTP-запросов
- [ ] Настройка React-Table для работы с таблицами
- [✅] Настройка библиотеки для работы с датами
- [ ] Настройка библиотеки для экспорта в Excel
- [ ] Настройка продвинутой библиотеки для таблиц (TanStack Table, AG Grid или MUI DataGrid)
- [✅] Интеграция библиотеки для интерактивных графиков и визуализаций
- [ ] Библиотека для работы с файлами и папками, включая drag-and-drop

### 1.4 Настройка работы с API
- [✅] Создание базового API-клиента для взаимодействия с бэкендом
- [✅] Генерация типов на основе API документации
- [✅] Настройка работы с аутентификацией в API
- [✅] Создание глобальных обработчиков ошибок API
- [✅] Реализация стандартных шаблонов запросов (CRUD)
- [✅] Настройка retry логики для нестабильных соединений

## 2. Аутентификация и авторизация 

### 2.1 Состояние аутентификации
- [✅] Создание хранилища auth в Zustand
- [✅] Реализация методов login, logout, register
- [✅] Хранение и обновление токенов
- [✅] Получение данных текущего пользователя
- [✅] Обработка истечения срока действия токена
- [✅] Сохранение состояния аутентификации в localStorage

### 2.2 API-клиент
- [✅] Настройка Axios с перехватчиками запросов
- [✅] Добавление токена аутентификации в заголовки
- [✅] Обработка ошибок аутентификации (401, 403)
- [✅] Обновление токена доступа с использованием refresh token
- [✅] Маршрутизация на страницу входа при истечении сессии

### 2.3 Компоненты аутентификации
- [✅] Страница входа с формой и валидацией
- [ ] Страница регистрации с формой и валидацией
- [✅] Компонент защищенных маршрутов (PrivateRoute)
- [✅] Компонент для ограничения доступа к маршрутам по ролям
- [✅] Компонент для отображения/скрытия элементов в зависимости от роли

### 2.4 Профиль пользователя
- [✅] Страница профиля пользователя
- [✅] Форма редактирования профиля
- [ ] Функциональность изменения пароля
- [ ] Обработка аватара пользователя
- [✅] Отображение информации о компании пользователя

### 2.5 Разграничение доступа по ролям
- [✅] Настройка маршрутизации в зависимости от роли пользователя
- [ ] Суперпользователь: доступ к модулю компаний и администраторов компаний
- [ ] Администратор: доступ к управлению пользователями компании (boss, manager, warehouse, client) и модулям управления статусами/статьями
- [ ] Руководитель (boss): доступ к управлению клиентами, отправлениям, заявкам, финансам и аналитике
- [ ] Менеджер (manager): доступ к отправлениям и заявкам
- [ ] Склад (warehouse): ограниченный доступ к отправлениям и заявкам
- [ ] Клиент (client): доступ только к собственным отправлениям (с его заявками), заявкам и финансовым операциям

## 3. Модуль компаний 

### 3.1 Страница списка компаний
- [ ] Табличное представление компаний
- [ ] Функции поиска и фильтрации
- [ ] Пагинация и настройка количества элементов на странице
- [ ] Сортировка по столбцам
- [ ] Контекстные действия (редактирование, удаление)
- [ ] Кнопка создания новой компании

### 3.2 Формы работы с компаниями
- [ ] Модальное окно создания компании
- [ ] Форма редактирования компании
- [ ] Диалог подтверждения удаления
- [ ] Валидация форм с использованием Zod
- [ ] Отображение ошибок валидации

### 3.3 API-интеграция
- [ ] Создание API-сервиса для работы с компаниями
- [ ] Реализация CRUD-операций
- [ ] Обработка ошибок API и отображение уведомлений
- [ ] Оптимистичные обновления с помощью React Query
- [ ] Инвалидация кэша после операций

### 3.4 Управление пользователями компании
- [ ] Представление списка пользователей компании
- [ ] Создание и редактирование пользователей
- [ ] Назначение ролей пользователям
- [ ] Включение/отключение пользователей
- [ ] Фильтрация пользователей по ролям

## 4. Модуль отправок (Shipments) 

### 4.1 Инфраструктура
- [ ] Определение всех типов данных для отправок
- [ ] Создание API-сервиса для работы с отправками
- [ ] Создание хуков для работы с данными (useShipments, useShipmentDetails)
- [ ] Настройка кэширования и инвалидации кэша
- [ ] Настройка оптимистичных обновлений

### 4.2 Список отправок
- [ ] Создание компонента таблицы отправок
- [ ] Реализация фильтрации по дате, номеру, статусу
- [ ] Реализация поиска по номеру и комментарию
- [ ] Реализация сортировки по столбцам
- [ ] Добавление пагинации и настройка размера страницы
- [ ] Кнопка очистки фильтров
- [ ] Кнопка экспорта в Excel

### 4.3 Создание и редактирование отправок
- [ ] Модальное окно создания отправки
- [ ] Редактирование отправки прямо в строке таблицы
- [ ] Выбор даты с использованием календаря
- [ ] Выбор статуса из выпадающего списка с поиском
- [ ] Валидация формы с использованием Zod
- [ ] Обработка ошибок и отображение уведомлений

### 4.4 Управление файлами отправок
- [ ] Компонент для просмотра файлов отправки
- [ ] Структура папок и файлов
- [ ] Загрузка файлов с drag-and-drop
- [ ] Скачивание файлов
- [ ] Удаление файлов
- [ ] Создание, редактирование и удаление папок

### 4.5 Детали отправки
- [ ] Страница детальной информации об отправке
- [ ] Отображение связанных заявок
- [ ] История статусов отправки
- [ ] Отображение комментариев
- [ ] Функциональность отправки уведомлений клиентам

## 5. Модуль заявок (Requests) 

### 5.1 Инфраструктура
- [ ] Определение всех типов данных для заявок
- [ ] Создание API-сервиса для работы с заявками
- [ ] Создание хуков для работы с данными (useRequests, useRequestDetails)
- [ ] Настройка кэширования и инвалидации кэша
- [ ] Настройка оптимистичных обновлений

### 5.2 Список заявок
- [ ] Создание компонента таблицы заявок
- [ ] Реализация фильтрации по дате, номеру, статусу, клиенту, отправке
- [ ] Реализация поиска по номеру, описанию, складскому номеру
- [ ] Реализация сортировки по столбцам
- [ ] Добавление пагинации и настройка размера страницы
- [ ] Кнопка очистки фильтров
- [ ] Кнопка экспорта в Excel

### 5.3 Создание и редактирование заявок
- [ ] Модальное окно создания заявки
- [ ] Редактирование заявки прямо в строке таблицы
- [ ] Выбор даты с использованием календаря
- [ ] Выбор статуса, клиента, отправления из выпадающих списков с поиском
- [ ] Валидация формы с Zod
- [ ] Автоматическое заполнение клиента для пользователей с ролью "клиент"
- [ ] Обработка ограничений редактирования в зависимости от роли и статуса

### 5.4 Управление файлами заявок
- [ ] Компонент для просмотра файлов заявки
- [ ] Загрузка файлов с drag-and-drop
- [ ] Скачивание файлов
- [ ] Удаление файлов (с учетом ограничений для клиентов)
- [ ] Обработка временных файлов при создании заявки

### 5.5 Связь с отправками
- [ ] Отображение данных связанной отправки
- [ ] Переход к просмотру отправки
- [ ] Привязка заявки к отправке
- [ ] Отображение статуса и комментария отправки

### 5.6 Специфический функционал для ролей
- [ ] Для склада: редактирование фактического веса и объема
- [ ] Для клиентов: ограничения по созданию, редактированию и удалению
- [ ] Для менеджеров: полный CRUD-функционал
- [ ] Для руководителей: расширенные возможности управления

## 6. Модуль финансов 

### 6.1 Инфраструктура
- [ ] Определение всех типов данных для финансовых операций
- [ ] Создание API-сервиса для работы с финансами
- [ ] Создание хуков для работы с финансовыми данными
- [ ] Настройка кэширования и инвалидации кэша
- [ ] Настройка оптимистичных обновлений

### 6.2 Счета и оплаты
- [ ] Создание компонента таблицы финансовых операций
- [ ] Реализация фильтрации по дате, номеру, типу операции, валюте, клиенту
- [ ] Реализация поиска по номеру и комментарию
- [ ] Сортировка по столбцам
- [ ] Пагинация и настройка размера страницы
- [ ] Кнопка очистки фильтров
- [ ] Кнопка экспорта в Excel

### 6.3 Создание и редактирование финансовых операций
- [ ] Модальное окно создания новой операции
- [ ] Редактирование операции
- [ ] Выбор дат с использованием календаря
- [ ] Выбор типа операции, типа документа, валюты, клиента из выпадающих списков
- [ ] Выбор статьи расходов/доходов
- [ ] Выбор связанного отправления, заявки, основания
- [ ] Управление статусом оплаты (галочка "Оплачено")
- [ ] Валидация формы с Zod

### 6.4 Калькуляция отправления
- [ ] Интерфейс выбора отправления
- [ ] Поля ввода курсов валют
- [ ] Таблица заявок отправления с расчетными полями
- [ ] Таблица затрат на отправление
- [ ] Кнопка расчета себестоимости
- [ ] Экспорт результатов в Excel

### 6.5 Баланс
- [ ] Интерфейс выбора валюты
- [ ] Отображение баланса компании по валютам
- [ ] Визуализация доходов и расходов
- [ ] Интерфейс выбора клиента
- [ ] Отображение баланса клиента по валютам

## 7. Модуль аналитики 

### 7.1 Инфраструктура
- [ ] Определение типов данных для аналитики
- [ ] Создание API-сервиса для получения аналитических данных
- [ ] Создание хуков для работы с аналитикой
- [ ] Интеграция библиотеки для визуализации данных (Chart.js, Recharts)

### 7.2 Дашборд
- [✅] Создание основного дашборда
- [✅] Карточки с ключевыми показателями (KPI)
- [ ] Фильтрация по периоду (день, неделя, месяц, год)
- [ ] Сравнение с предыдущими периодами
- [ ] Экспорт данных дашборда

### 7.3 Графики и диаграммы
- [✅] График отправок по статусам
- [✅] График заявок по статусам
- [✅] Круговая диаграмма доходов по валютам
- [✅] Круговая диаграмма расходов по валютам
- [✅] Линейный график финансовых показателей
- [ ] Столбчатая диаграмма по клиентам

### 7.4 Отчеты
- [ ] Шаблоны отчетов
- [ ] Настраиваемые параметры отчетов
- [ ] Экспорт отчетов в Excel
- [ ] Планирование автоматической отправки отчетов

## 8. Статусы и справочники 

### 8.1 Управление статусами отправлений
- [ ] Интерфейс для администраторов
- [ ] Таблица существующих статусов
- [ ] Создание, редактирование, удаление статусов
- [ ] Настройка порядка статусов
- [ ] Установка дефолтного и финального статуса

### 8.2 Управление статусами заявок
- [ ] Интерфейс для администраторов
- [ ] Таблица существующих статусов
- [ ] Создание, редактирование, удаление статусов
- [ ] Настройка порядка статусов
- [ ] Установка дефолтного и финального статуса

### 8.3 Управление статьями расходов и доходов
- [ ] Интерфейс для администраторов
- [ ] Таблица существующих статей
- [ ] Создание, редактирование, удаление статей
- [ ] Фильтрация и поиск статей

## 9. Клиентский интерфейс 

### 9.1 Дашборд клиента
- [ ] Создание специализированного дашборда для клиентов
- [ ] Отображение только своих заявок и связанных отправок
- [ ] Карточки с текущими статусами
- [ ] Кнопка создания новой заявки
- [ ] Уведомления об изменениях статусов

### 9.2 Заявки клиента
- [ ] Специальное представление заявок для клиентов
- [ ] Ограниченный функционал редактирования
- [ ] Фильтрация по статусам
- [ ] Возможность создания новых заявок
- [ ] Работа с файлами заявок согласно ограничениям

### 9.3 Отправки клиента
- [ ] Просмотр только связанных отправок
- [ ] Отображение статусов и комментариев
- [ ] Трекинг отправок
- [ ] История изменения статусов

### 9.4 Финансы клиента
- [ ] Просмотр только своих финансовых операций
- [ ] Фильтрация по типам и статусам
- [ ] Отображение баланса по валютам

## 10. Интерфейс склада 

### 10.1 Специализированные представления
- [ ] Оптимизированный интерфейс для сотрудников склада
- [ ] Фокус на актуальных отправках и заявках
- [ ] Быстрый доступ к функциям изменения статусов
- [ ] Редактирование фактического веса и объема

### 10.2 Работа с файлами
- [ ] Интерфейс для загрузки файлов
- [ ] Создание папок и организация файлов
- [ ] Просмотр и скачивание документов

## 11. Общие улучшения и оптимизация 

### 11.1 UI/UX улучшения
- [✅] Реализация адаптивного дизайна для всех страниц
- [ ] Реализация темной темы
- [✅] Добавление анимаций и переходов
- [✅] Реализация скелетон-лоадеров для всех компонентов
- [ ] Оптимизация форм для мобильных устройств

### 11.2 Производительность
- [ ] Оптимизация ре-рендеров с использованием React.memo, useMemo, useCallback
- [ ] Реализация виртуализации для больших списков
- [ ] Оптимизация загрузки изображений
- [ ] Кэширование часто используемых данных
- [ ] Ленивая загрузка компонентов
- [ ] Разделение кода (code splitting)

### 11.3 Тестирование
- [ ] Настройка Jest/Vitest для unit-тестов компонентов
- [ ] Настройка React Testing Library для тестирования компонентов
- [ ] Реализация mock-сервера для тестирования API интеграций
- [ ] Внедрение Cypress для e2e тестирования ключевых пользовательских сценариев
- [ ] Тесты для проверки правильности авторизации и разграничения доступа
- [ ] Мониторинг производительности

### 11.4 Безопасность
- [✅] Проверка и усиление безопасности авторизации
- [ ] Защита от XSS, CSRF и других атак
- [✅] Валидация всех пользовательских вводов
- [ ] Аудит безопасности сторонних библиотек
- [ ] Обработка чувствительных данных

### 11.4.1 Обработка ошибок API
- [✅] Создание глобального обработчика ошибок
- [✅] Интеграция уведомлений для пользователей (toast, alerts)
- [✅] Логирование ошибок
- [✅] Обработка ошибок аутентификации и авторизации
- [✅] Автоматические ретраи после сетевых ошибок

### 11.5 Доступность (Accessibility)
- [✅] Оптимизация для скринридеров
- [ ] Соответствие WCAG 2.1
- [✅] Клавиатурная навигация
- [ ] Цветовые контрасты
- [ ] Альтернативные тексты для изображений

### 11.6 Локализация
- [ ] Настройка i18n библиотеки (react-i18next или аналог)
- [ ] Создание файлов переводов для разных языков
- [ ] Компонент переключения языков в интерфейсе
- [ ] Адаптация форматирования дат, чисел и валют для разных локалей
- [ ] Контекстные переводы для сложных компонентов

## Условные обозначения
✅ - Реализовано
🔄 - В процессе
❌ - Не начато

## Приоритеты разработки
1. **Высокий приоритет**: Аутентификация и авторизация, Модуль отправок, Модуль заявок, Клиентский интерфейс
2. **Средний приоритет**: Модуль финансов, Статусы и справочники, Интерфейс склада
3. **Низкий приоритет**: Модуль аналитики, Общие улучшения и оптимизация

## Оценка времени
- **Аутентификация и авторизация**: ~2 недели
- **Модуль компаний (для суперпользователя)**: ~2 недели
- **Модуль отправок**: ~4 недели
- **Модуль заявок**: ~3 недели
- **Модуль финансов**: ~3 недели
- **Модуль аналитики**: ~2 недели
- **Статусы и справочники**: ~1 неделя
- **Клиентский интерфейс**: ~2 недели
- **Интерфейс склада**: ~1 неделя
- **Общие улучшения и оптимизация**: ~2 недели
- **Локализация**: ~1 неделя

**Общее время на разработку**: ~23 недели
